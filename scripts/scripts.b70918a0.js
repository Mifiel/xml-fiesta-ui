(function(){"use strict";angular.module("xmlFiestaUiApp",["ngAnimate","ngCookies","ngResource","ui.router","ngSanitize","ngTouch","pdf","LocalStorageModule","pascalprecht.translate"]).config(["localStorageServiceProvider","$translateProvider","$compileProvider","TRANSLATIONS_EN","TRANSLATIONS_ES",function(a,b,c,d,e){return a.setPrefix("XMLFiesta"),b.translations("en",d).translations("es",e).preferredLanguage("es").fallbackLanguage("en").useSanitizeValueStrategy("sanitizeParameters"),c.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|blob):/)}]).config(["$stateProvider","$urlRouterProvider",function(a,b){return a.state("verify",{url:"/",templateUrl:"views/verify.html",controller:"VerifyCtrl",controllerAs:"verify"}).state("how",{url:"/how",templateUrl:"views/how.html",controller:"HowCtrl",controllerAs:"how"}).state("config",{url:"/config",templateUrl:"views/config.html",controller:"ConfigCtrl",controllerAs:"config"}),b.otherwise("/")}])}).call(this),function(){angular.module("xmlFiestaUiApp").constant("TRANSLATIONS_ES",{HEADER:{HOME:"¿Cómo Funciona?",VERIFY:"Verificar XML",FAQ:"¿Cómo Funciona?",CONTACT:"Contacto",CONFIG:"Configuración"},VERIFY:{TITLE:"¿Cómo Funciona?",ROOT:"Carga los certificados raíz correspondientes. Actualmente este validador sólo funciona con certificados emitidos por el SAT de México.",XML:"Carga el archivo XML que quieras verificar. El archivo XML contiene toda la información necesaria para realizar esta verificación.",VALIDATION:"El sistema realizará las validaciones necesarias. Es necesario que todas sean exitosas para garantizar la legitimidad del documento.",GET_STARTED:"Comienza Ahora",DRAG:"Arrastra el XML que quieras verificar",SELECT:"o haz click aquí para seleccionar uno",VALIDATIONS:"Validaciones",REMINDER:"Asegúrate de revisar que ninguno de los campos muestre un error (tache rojo). En ausencia de errores puedes estar seguro de que el documento fue firmado correctamente.",DOCUMENT_NAME:"Documento",ORIG_HASH:"Hash Original ",WHY:"¿Por qué?",WRONG_HASH:"El hash calculado no coincide con el hash del documento original. El documento original fue cambiado o se está usando el hash de otro documento.",SIGNER:"Firmante",ID:"RFC",SIG_DATE:"Fecha de Firma",CERT_NUMBER:"Núm de Certificado ",REVIEW:"A continuación puedes revisar el documento que fue firmado.",NEW_DOC:"Validar otro documento",SIGNATURE:"Firma ",WRONG_CERT:"El certificado no fue firmado con ninguno de los certificados raíz que cargaste en la página de configuración. Asegúrate de haber cargado todos los certificados raíz de la autoridad que emitió el certificado usado para firmar. Si este error persiste significa que el certificado no fue emitido por la autoridad certificadora dueña de los certificados raíz.",WRONG_SIG:"La Firma no es válida, pudo haber sido modificada o no se usó la llave privada correspondiente al certificado mencionado anteriormente.",LOADING:"Validando documento...",INFORMATION_DOCUMENT:"Información identificadora del documento firmado",INFORMATION_SIGNER:"Información identificadora de cada firmante",CONSERVANCY_RECORD:"Constancia de conservación",RECORD:{ISSUER:"Emisor",TIMESTAMP:"Fecha",VALIDITY:"Validez",WRONG_TS:"La fecha del XML ({{xmlTS}}) no coincide con la fecha de la constancia de conservación ({{recordTS}}).",WRONG_CR:"La constancia de conservación en el XML no está presente o no tiene una esctructura válida.",WRONG_ARCHIVE:"El documento o las firmas han sido modificados desde la emisión de la constancia.",VALID_ARCHIVE:"La constancia de conservación coincide con documento y firmas."},ENCRYPT:{ALERT:"Debido a que cargaste un <b>XML encriptado</b> del documento firmado, no podemos validar el Hash Original ni la Firma. Para validar todos los campos, presiona “Validar otro documento” y carga el <b>XML desencriptado</b> del documento firmado.",HASH_NOT_AVAILABLE:"El Hash Original no puede ser validado porque el XML que cargaste está encriptado.",SIGNATURE_NOT_AVAILABLE:"La firma no puede ser validada porque el XML que cargaste está encriptado.",NOTE:"No podemos mostrar el contenido del documento firmado porque el XML está encriptado. Para visualizar su contenido, presiona “Validar otro documento” y carga el <b>XML desencriptado</b> del documento firmado."}},FAQ:{ABOUT:"Acerca de",INTRO:"XML Fiesta es una herramienta para validar Firmas Electrónicas Avanzadas.",NOTICE:"*Esta versión soporta únicamente documentos firmados usando la FIEL (eFirma) del SAT a través de la plataforma de ",HOW:"¿Cómo Funciona?",FIRST:"1. Cargar los certificados raíz de la autoridad certificadora (ej. SAT) que emitió los certificados con los que se firmó el documento.",SECOND:"2. Seleccionar o arrastrar el documento firmado (en formato XML).",THIRD:"3. La aplicación realizará tres validaciones y si se cumplen todas podrás estar 100% seguro de que tienes un documento firmado correctamente por la persona o personas indicadas otorgándole todo el valor legal que la ley le confiere a los documentos firmados mediante Firmas Electrónicas Avanzadas.",WHAT:"¿Qué valida esta aplicación?",VALIDATION_1:"1. Que la huella digital o hash del documento original (PDF) sea la correcta.",VALIDATION_2:"2. Que los certificados que se usaron para firmar no sean apócrifos.",VALIDATION_3:"3. Que la Firma Electrónica corresponda al documento que se firmó.",QUESTIONS:"¿Dudas o preguntas?",EMAIL:"Envíanos un correo"},FOOTER:{MADE:"Hecho ",MADE2:"por el equipo de ",SOURCE_CODE:"Ver código fuente"},CONFIG:{CERTIFICATES_LOADED:"¿Haz cargado todos los Certificados Raíz?",VER_BUTTON:"Proceder a verificar",SELECT:"Carga los Certificados Raíz",ALL:"Asegúrate de seleccionar todos los certificados raíz correspondientes a la autoridad certificadora. Puedes seleccionar varios certificados a la vez.",AFTER:"Una vez que hayas cargado los certificados raíz verás un botón que te permitirá seguir con el proceso de validación de un archivo XML.",LOADED:"Certificados Raíz que has cargado",DELETE:"Borrar todos los certificados ",UNDONE:"(Está acción no puede ser revertida, tendrás que cargarlos de nuevo)"}})}.call(this),function(){angular.module("xmlFiestaUiApp").constant("TRANSLATIONS_EN",{HEADER:{HOME:"Home",VERIFY:"Verify XML",CONTACT:"Contact",CONFIGURATION:"Configuration"},VERIFY:{ENCRYPT:{ALERT:"Since you loaded an <b>encrypted XML</b> of the signed document, we cannot validate the Original Hash or the Signature. To validate all fields, click on “Validate another document” and load the <b>decrypted XML</b> of the signed document.",HASH_NOT_AVAILABLE:"The original hash cannot be validated because the XML you loaded is encrypted.",SIGNATURE_NOT_AVAILABLE:"The signature cannot be validated because the XML you loaded is encrypted.",NOTE:"We can't show the contents of the signed document because the XML is encrypted. To visualize its contents, click on “Validate another document” and load the <b>decrypted XML</b> of the signed document."}}})}.call(this),function(){"use strict";angular.module("xmlFiestaUiApp").controller("MainCtrl",function(){})}.call(this),function(){"use strict";angular.module("xmlFiestaUiApp").controller("VerifyCtrl",["$scope","$q","$timeout","$filter","localStorageService",function(a,b,c,d,e){var f,g,h;PDFJS.workerSrc="scripts/pdf.worker.js",f=function(){var b,c;a.certs=[],a.nom151Ca=[],b=e.get("rootCerts"),c=e.get("nom151Ca"),c&&angular.forEach(c,function(b){return a.nom151Ca.push(b)}),b&&angular.forEach(b,function(b){return a.certs.push(b)})},f(),a.clear=function(){a.ready=a.certs.length>0,a.upload=null,a.doc=null,a.pdfUrl=null,a.loading=!1,angular.element(".file-upload-input").val("")},a.clear(),g=function(){return a.doc.recordPresent&&(a.record instanceof XMLFiesta.ConservancyRecord||a.record instanceof XMLFiesta.ConservancyRecordNom2016)?(a.record.valid=a.record.valid(),a.record.validTS=a.record.equalTimestamps(),a.record.validCA=!0,a.record.validArchive=a.record.validArchiveHash(),a.record.tsTranslation={recordTS:d("date")(a.record.recordTimestamp(),"medium","UTC"),xmlTS:d("date")(Date.parse(a.record.timestamp),"medium","UTC")}):a.doc.recordPresent&&a.doc.errors.recordInvalid?a.record={valid:!1}:void 0},h=function(){return a.signatures.forEach(function(b){return b.valid=b.valid(a.doc.originalHash),b.certificate.valid=!1,angular.forEach(a.certs,function(a){b.certificate.valid||(b.certificate.valid=b.certificate.isCa(a.content))})})},a.parseXML=function(b){var c;c=XMLFiesta.Document.fromXml(b),c.then(function(b){var c,d;d=b.document,a.doc=d,a.oHashValid=b.xmlOriginalHash===d.originalHash,a.signatures=d.signatures(),a.record=d.conservancyRecord||null,g(),h(),c=new Blob([d.pdfBuffer()],{type:"application/pdf"}),a.pdfUrl=URL.createObjectURL(c),a.loading=!1,a.$apply()}).catch(function(b){var c;c="XML Format is invalid: "+b.message,a.error=c,console.error(a.error),a.$apply(),a.loading=!1})},a.$watch("upload",function(b){b&&(a.loading=!0,c(function(){a.parseXML(b.result.raw)},50))})}])}.call(this),function(){"use strict";angular.module("xmlFiestaUiApp").controller("HowCtrl",function(){})}.call(this),function(){"use strict";angular.module("xmlFiestaUiApp").controller("ConfigCtrl",["$scope","localStorageService",function(a,b){var c,d;c=function(){var c,d;a.certs=[],a.nom151Ca=[],c=b.get("rootCerts"),d=b.get("nom151Ca"),d&&angular.forEach(d,function(b){return a.nom151Ca.push(b)}),c&&angular.forEach(c,function(b){return a.certs.push(b)})},c(),a.removeNom151Ca=function(){return b.remove("nom151Ca"),c()},a.removeCerts=function(){return b.remove("rootCerts"),c()},a.clear=function(){return b.clearAll(),c()},d=function(d,e){var f;return f=b.get(e)||{},angular.forEach(d.target.files,function(d){var g;return g=new FileReader,g.addEventListener("load",function(a){return f[d.name]={name:d.name,content:a.target.result},b.set(e,f),angular.element(".cert-uploader").val("")}),g.addEventListener("loadend",function(){return c(),a.$apply()}),g.readAsText(d)})},a.setRootCerts=function(a){return d(a,"rootCerts")},a.setNom151Ca=function(a){return d(a,"nom151Ca")}}]).directive("customOnChange",function(){return{restrict:"A",link:function(a,b,c){var d;return d=a.$eval(c.customOnChange),b.bind("change",d)}}})}.call(this),function(){angular.module("xmlFiestaUiApp").directive("dropzone",[function(){return{link:function(a,b){b.bind("dragover",function(a){a.stopPropagation(),$(this).addClass("image-dropping")}).bind("dragleave",function(a){a.stopPropagation(),$(this).removeClass("image-dropping")}).bind("drop",function(a){a.stopPropagation(),$(this).removeClass("image-dropping")}),$("body").bind("dragover",function(a){a.stopPropagation(),b.addClass("image-dragging")}).bind("dragleave",function(a){a.stopPropagation(),b.removeClass("image-dragging")})}}}])}.call(this),function(){angular.module("xmlFiestaUiApp").directive("fileread",[function(){"use strict";return{scope:{fileread:"="},link:function(a,b,c){b.bind("change",function(b){var d,e,f,g,h,i;if(i=new FileReader,g=b.target.files[0],d=c.accept?c.accept.replace(".","").toLowerCase():null,e=void 0,h=void 0,f=void 0,g){if(e=c.accept===g.type,h=null!==g.type.match(d),f=g.name.substr(-3)===d,!(e||h||f))return void a.$apply(function(){a.fileread={errors:["Este tipo de archivo no está soportado, por favor sube un "+c.acceptName+"."]}});i.addEventListener("load",function(b){a.$apply(function(){var c;c=b.target.result,a.fileread={type:g.type,name:g.name,file:g,result:{data:"",hash:"",raw:c}}})}),!g||angular.isDefined(c.raw)&&"false"===c.raw||(c.binary?i.readAsBinaryString(g):c.text?i.readAsText(g):i.readAsArrayBuffer(g))}})}}}])}.call(this),angular.module("xmlFiestaUiApp").run(["$templateCache",function(a){"use strict";a.put("views/config.html",'<div class="config"> <div class="row"> <div class="col-md-12"> <div ng-show="certs.length > 0" class="proceed-verify"> <h4>{{ \'CONFIG.CERTIFICATES_LOADED\' | translate }}</h4> <button class="btn-lg btn-success" ui-sref="verify">{{ \'CONFIG.VER_BUTTON\' | translate }}</button> </div> </div> </div> <div class="row"> <div class="col-md-6"> <div class="form-group upload-certificates"> <h3>{{ \'CONFIG.SELECT\' | translate }}</h3> <p class="help-block top-padder-md">{{ \'CONFIG.ALL\' | translate }}</p> <p class="help-block top-padder-md">{{ \'CONFIG.AFTER\' | translate }}</p> <p class="help-block top-padder-md bottom-padder-md"> Puedes bajar los certificados <a href="https://github.com/Mifiel/xml-fiesta-ui/raw/master/doc/root-certificates/MX/root-certificates.zip" target="_blank">aquí</a>. </p> <h4><strong>Carga de Certificados de firma</strong></h4> <input type="file" accept=".crt" class="cert-uploader" custom-on-change="setRootCerts" multiple> <h4><strong>Carga de Certificados de constancia</strong></h4> <input type="file" accept=".crt" class="nom151Ca-uploader" custom-on-change="setNom151Ca" multiple> </div> </div> <div class="col-md-5 col-md-offset-1"> <div ng-show="certs.length > 0 || nom151Ca.length > 0" class="root-certificates"> <div ng-show="certs.length > 0"> <h4> {{ \'CONFIG.LOADED\' | translate }} </h4> <ul class="bottom-padder-md"> <li ng-repeat="cert in certs | orderBy:\'name\'"> {{ cert.name }} </li> </ul> </div> <div ng-show="nom151Ca.length > 0"> <h4> Certificados Raíz de constancia <a href="" class="text-small mi_u-colorRed250 unstyled glyphicon glyphicon-trash" ng-click="removeNom151Ca()"></a> </h4> <ul class="bottom-padder-md"> <li ng-repeat="cert in nom151Ca | orderBy:\'name\'"> {{ cert.name }} </li> </ul> </div> </div> <div ng-show="certs.length > 0">{{ \'CONFIG.DELETE\' | translate }}<b>{{ \'CONFIG.UNDONE\' | translate }}</b> <button ng-click="clear()" class="btn btn-md btn-delete glyphicon glyphicon-trash"></button> </div> </div> </div> </div>'),a.put("views/how.html","<div id=\"how-it-works\"> <h3>{{ 'FAQ.ABOUT' | translate }}</h3> <p>{{ 'FAQ.INTRO' | translate }}</p> <p class=\"help-block\"><em>{{ 'FAQ.NOTICE' | translate }}<a href=\"https://www.mifiel.com\">Mifiel</a></em></p> <h3 class=\"top-padder-md\">¿Cómo Funciona?</h3> <p>Para utilizarla sólo tienes que:</p> <p>{{ 'FAQ.FIRST' | translate }}</p> <p>{{ 'FAQ.SECOND' | translate }}</p> <p>{{ 'FAQ.THIRD' | translate }}</p> <h3 class=\"top-padder-md\">{{ 'FAQ.WHAT' | translate }}</h3> <p>{{ 'FAQ.VALIDATION_1' | translate }}</p> <p>{{ 'FAQ.VALIDATION_2' | translate }}</p> <p>{{ 'FAQ.VALIDATION_3' | translate }}</p> </div> <div class=\"contact\"> <object data=\"images/email.2e8137ee.svg\" type=\"image/svg+xml\" alt=\"Contáctanos\"></object> <h3>{{ 'FAQ.QUESTIONS' | translate }}</h3> <a href=\"mailto:hola@mifiel.com\" class=\"btn btn-md btn-success\">{{ 'FAQ.EMAIL' | translate }}</a> </div>"),a.put("views/main.html",'<div> <h1>Hello</h1> <p><a class="btn btn-lg btn-success" ng-href="#/">Splendid!<span class="glyphicon glyphicon-ok"></span></a></p> <img src="images/yeoman.png" alt="I\'m Yeoman"><br> </div>'),a.put("views/pdfViewer.html",'<nav class="pdf-controls" ng-class="getNavStyle(scroll)"> <span>Página </span> <span class="margin-right-sm"><b>{{pageNum}}</b> de {{pageCount}}</span> <button class="btn btn-sm btn-success" ng-click="goPrevious()">&lt;</button> <button class="btn btn-sm btn-success margin-right-sm" ng-click="goNext()">&gt;</button> <a href="{{pdfUrl}}" target="_blank">Descargar</a> </nav> <canvas id="pdf-canvas" class="rotate0"></canvas>'),a.put("views/verify.html",'<div class="verify"> <div id="instructions" ng-if="!ready"> <div class="row"> <h2>{{ \'VERIFY.TITLE\' | translate }}</h2> </div> <div class="row bottom-padder-md"> <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1 col-md-offset-0 col-sm-10 col-sm-offset-1"> <object data="images/upload_certificates.d73fe3f9.svg" type="image/svg+xml" alt="Upload Certificates"></object> <p>{{ \'VERIFY.ROOT\' | translate }}</p> </div> <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1"> <object data="images/upload_xml.68a4b24b.svg" type="image/svg+xml" alt="Upload XML"></object> <p>{{ \'VERIFY.XML\' | translate }}</p> </div> <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1"> <object data="images/verify.f956272a.svg" type="image/svg+xml" alt="Verify information"></object> <p>{{ \'VERIFY.VALIDATION\' | translate }}</p> </div> </div> <div class="row top-padder-md"> <button class="btn-lg btn-success" ui-sref="config">{{ \'VERIFY.GET_STARTED\' | translate }}</button> </div> </div> <div class="row" ng-show="ready && !pdfUrl"> <div class="upload text-center" dropzone> <div class="upload-default"> <div ng-show="!loading"> <h5 class="bottom-padder-md">{{ \'VERIFY.DRAG\' | translate }}</h5> <button class="btn">{{ \'VERIFY.SELECT\' | translate }}</button> <input accept-name="XML" accept="text/xml" text="true" class="file-upload-input" fileread="upload" required type="file"> </div> <div ng-show="loading"> <h4>{{ \'VERIFY.LOADING\' | translate }}</h4> </div> <div class="mi_u-colorRed250" ng-show="error"> <h4>{{ error }}</h4> </div> </div> </div> </div> <section class="row mi_VerifyXml" ng-show="pdfUrl && !loading"> <h2 class="col-xs-12 mi_u-fontWeightBold mi_u-marginB3X mi_u-textAlignCenter">{{ \'VERIFY.VALIDATIONS\' | translate }}</h2> <div class="alert alert-warning mi_u-textAlignCenter mi_u-inlineBlock" ng-if="doc.encrypted"><p class="mi_u-inlineBlock" translate="VERIFY.ENCRYPT.ALERT"></p></div> <p class="col-xs-12 mi_u-marginB8X">{{ \'VERIFY.REMINDER\' | translate }}</p> <strong class="col-xs-12 mi_u-fontWeightBold mi_u-marginB2X"> {{ \'VERIFY.INFORMATION_DOCUMENT\' | translate }} </strong> <div class="col-md-3 col-sm-4 mi_u-coreNeutral600 mi_u-marginB1X"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.DOCUMENT_NAME\' | translate }}</strong> </div> <div class="col-md-9 col-sm-8 mi_u-fontWeightBold mi_u-coreNeutral600 mi_u-marginB1X mi_u-textBreakAll"> {{ doc.name }} </div> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X" ng-class="{\'mi_u-colorGreen300\': oHashValid, \'mi_u-colorRed250\': !oHashValid, \'mi_u-colorYellow300\': doc.encrypted}"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.ORIG_HASH\' | translate }}<i class="glyphicon" ng-class="{\'glyphicon-ok\': oHashValid, \'glyphicon-remove\': !oHashValid, \'glyphicon-lock\': doc.encrypted}"></i></strong> </div> <div class="col-md-9 col-sm-8 mi_u-marginB8X mi_u-textBreakAll"> <p>{{ doc.originalHash }}</p> <a class="mi_u-colorRed250 mi_u-textDecorationUnderline mi_u-fontWeightBold" href="" ng-show="!oHashValid" ng-click="showOHashError = !showOHashError">{{ \'VERIFY.WHY\' | translate }}</a> <div class="alert alert-danger alert-incorrect" ng-show="showOHashError" role="alert"> <p>{{ \'VERIFY.WRONG_HASH\' | translate }}</p> </div> <p class="mi_u-colorRed250" ng-if="doc.encrypted">{{ \'VERIFY.ENCRYPT.HASH_NOT_AVAILABLE\' | translate }}</p> </div> <div> <strong class="col-xs-12 mi_u-fontWeightBold mi_u-marginB2X"> {{ \'VERIFY.INFORMATION_SIGNER\' | translate }} </strong> <div id="signers" ng-repeat="signature in signatures"> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.SIGNER\' | translate }}</strong> </div> <div class="col-md-9 col-sm-8 mi_u-fontWeightBold mi_u-coreNeutral600 mi_u-marginB1X mi_u-textBreakAll"> {{ signature.signer.name }} &lt;{{ signature.signer.email }}&gt; </div> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.ID\' | translate }}</strong> </div> <div class="col-md-9 col-sm-8 mi_u-marginB1X mi_u-textBreakAll"> {{ signature.signer.id }} </div> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.SIG_DATE\' | translate }}</strong> </div> <div class="col-md-9 col-sm-8 mi_u-marginB1X mi_u-textBreakAll"> {{ signature.signedAt | date:\'medium\':\'UTC\' }} </div> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X" ng-class="{\'mi_u-colorGreen300\': signature.certificate.valid, \'mi_u-colorRed250\': !signature.certificate.valid}"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.CERT_NUMBER\' | translate }}<i class="glyphicon" ng-class="{\'glyphicon-ok\': signature.certificate.valid, \'glyphicon-remove\': !signature.certificate.valid}"></i></strong> </div> <div class="col-md-9 col-sm-8 mi_u-marginB1X mi_u-textBreakAll"> {{ signature.certificate.getSerialNumber() }} <a class="mi_u-colorRed250 mi_u-textDecorationUnderline mi_u-fontWeightBold" href="" ng-show="!signature.certificate.valid" ng-click="signature.showCertError = !signature.showCertError">{{ \'VERIFY.WHY\' | translate }}</a> <div class="alert alert-danger alert-incorrect" ng-show="signature.showCertError" role="alert"> <p>{{ \'VERIFY.WRONG_CERT\' | translate }}</p> </div> </div> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X" ng-class="{\'mi_u-colorGreen300\': signature.valid, \'mi_u-colorRed250\': !signature.valid, \'mi_u-colorYellow300\': doc.encrypted}"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.SIGNATURE\' | translate }}<i class="glyphicon" ng-class="{\'glyphicon-ok\': signature.valid, \'glyphicon-remove\': !signature.valid, \'glyphicon-lock\': doc.encrypted}"></i></strong> </div> <div class="col-md-9 col-sm-8 mi_u-marginB8X mi_u-textBreakAll"> <p>{{ signature.sig(\'base64\') }}</p> <a class="mi_u-colorRed250 mi_u-textDecorationUnderline mi_u-fontWeightBold" href="" ng-show="!signature.valid" ng-click="signature.showValidError = !signature.showValidError">{{ \'VERIFY.WHY\' | translate }}</a> <div class="alert alert-danger alert-incorrect" ng-show="signature.showValidError" role="alert"> <p>{{ \'VERIFY.WRONG_SIG\' | translate }}</p> </div> <p class="mi_u-colorRed250" ng-if="doc.encrypted">{{ \'VERIFY.ENCRYPT.SIGNATURE_NOT_AVAILABLE\' | translate }}</p> </div> </div> </div> <div class="mi_u-inlineBlock" ng-show="record" id="conservancy-record"> <div class="col-xs-12 mi_u-marginB1X" ng-class="{\'mi_u-colorRed250\': !record.valid}"> <strong class="mi_u-fontWeightBold mi_u-marginB2X"> {{ \'VERIFY.CONSERVANCY_RECORD\' | translate }} <i class="glyphicon" ng-class="{\'glyphicon-remove\': !record.valid}"></i> </strong> <a class="mi_u-colorRed250 mi_u-textDecorationUnderline mi_u-fontWeightBold" ng-show="!record.valid" href="" ng-click="record.showValidCR = !record.showValidCR">{{ \'VERIFY.WHY\' | translate }}</a> <div class="alert alert-danger alert-incorrect" ng-show="record.showValidCR" role="alert"> <p>{{ \'VERIFY.RECORD.WRONG_CR\' | translate }}</p> </div> </div> <div ng-show="record.valid"> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X" ng-class="{\'mi_u-colorGreen300\': record.validCA, \'mi_u-colorRed250\': !record.validCA}"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase">{{ \'VERIFY.RECORD.ISSUER\' | translate }}</strong> <i class="glyphicon" ng-class="{\'glyphicon-ok\': record.validCA, \'glyphicon-remove\': !record.validCA}"></i> </div> <div class="col-md-9 col-sm-8 mi_u-fontWeightBold mi_u-coreNeutral600 mi_u-marginB1X"> {{ record.caName() }} </div> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4 mi_u-marginB1X" ng-class="{\'mi_u-colorGreen300\': record.validTS, \'mi_u-colorRed250\': !record.validTS}"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase"> {{ \'VERIFY.RECORD.TIMESTAMP\' | translate }} <i class="glyphicon" ng-class="{\'glyphicon-ok\': record.validTS, \'glyphicon-remove\': !record.validTS}"></i> </strong> </div> <div class="col-md-9 col-sm-8 mi_u-marginB1X"> {{ record.recordTimestamp() | date:\'medium\':\'UTC\' }} <a class="mi_u-colorRed250 mi_u-textDecorationUnderline mi_u-fontWeightBold" href="" ng-show="!record.validTS" ng-click="record.showValidTS = !record.showValidTS">{{ \'VERIFY.WHY\' | translate }}</a> <div class="alert alert-danger alert-incorrect" ng-show="record.showValidTS" role="alert"> <p>{{ \'VERIFY.RECORD.WRONG_TS\' | translate:record.tsTranslation }}</p> </div> </div> <div class="mi_VerifyXml-attributeName col-md-3 col-sm-4" ng-class="{\'mi_u-colorGreen300\': record.validArchive, \'mi_u-colorRed250\': !record.validArchive}"> <strong class="mi_u-fontWeightBold mi_u-textTransformUppercase"> {{ \'VERIFY.RECORD.VALIDITY\' | translate }} <i class="glyphicon" ng-class="{\'glyphicon-ok\': record.validArchive, \'glyphicon-remove\': !record.validArchive}"></i> </strong> </div> <div class="col-md-9 col-sm-8 mi_u-marginB8X"> <p ng-show="!record.validArchive"> {{ \'VERIFY.RECORD.WRONG_ARCHIVE\' | translate }} </p> <p ng-show="record.validArchive"> {{ \'VERIFY.RECORD.VALID_ARCHIVE\' | translate }} </p> </div> </div> </div> <div class="col-xs-12 mi_u-textAlignCenter mi_u-marginB3X"> <p class="mi_u-marginB3X mi_u-fontWeightBold">{{ \'VERIFY.REVIEW\' | translate }}</p> <button class="btn-lg btn-success" ng-click="clear()">{{ \'VERIFY.NEW_DOC\' | translate }}</button> </div> <div class="col-xs-12" ng-if="doc.encrypted"> <hr class="mi_u-divider"> <p class="mi_VerifyXml-note mi_u-marginB3X mi_u-fontWeightBold mi_u-textAlignCenter" translate="VERIFY.ENCRYPT.NOTE"></p> </div> <div id="pdf-container" class="col-xs-12 mi_u-textAlignCenter mi_u-marginB3X" ng-if="!doc.encrypted"> <ng-pdf template-url="views/pdfViewer.html"></ng-pdf> </div> </section> </div>')}]);