<div class="verify">
  <div id="instructions" ng-if="!ready">
    <div class="row">
      <h2>{{ 'VERIFY.TITLE' | translate }}</h2>
    </div>
    <div class="row bottom-padder-md">
      <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1 col-md-offset-0 col-sm-10 col-sm-offset-1">
        <object data="images/upload_certificates.svg" type="image/svg+xml" alt="Upload Certificates"></object>
        <p>{{ 'VERIFY.ROOT' | translate }}</p>
      </div>
      <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1">
        <object data="images/upload_xml.svg" type="image/svg+xml" alt="Upload XML"></object>
        <p>{{ 'VERIFY.XML' | translate }}</p>
      </div>
      <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1">
        <object data="images/verify.svg" type="image/svg+xml" alt="Verify information"></object>
        <p>{{ 'VERIFY.VALIDATION' | translate }}</p>
      </div>
    </div>
    <div class="row top-padder-md">
      <button class="btn-lg btn-success" ui-sref="config">{{ 'VERIFY.GET_STARTED' | translate }}</button>
    </div>
  </div>

  <div class="row" ng-show="ready && !pdfUrl">
    <div class="upload text-center" dropzone>
      <div class="upload-default">
        <div ng-show="!loading">
          <h5 class="bottom-padder-md">{{ 'VERIFY.DRAG' | translate }}</h5>
          <button class="btn">{{ 'VERIFY.SELECT' | translate }}</button>
          <input accept-name="XML" accept="text/xml" text="true" class="file-upload-input" fileread="upload" required="true" type="file">
        </div>
        <div ng-show="loading">
          <h4>{{ 'VERIFY.LOADING' | translate }}</h4>
        </div>
        <div class="text-danger" ng-show="error">
          <h4>{{ error }}</h4>
        </div>
      </div>
    </div>
  </div>

  <div class="verify-in-short col-md-offset-1 col-md-10 col-sm-12" ng-show="pdfUrl && !loading">
    <h2 class="center">{{ 'VERIFY.VALIDATIONS' | translate }}</h2>

    <p class="help-block">{{ 'VERIFY.REMINDER' | translate }}</p>

    <div class="verify-info row top-padder-md">

      <div class="col-md-3 col-sm-4">
        <strong>{{ 'VERIFY.DOCUMENT_NAME' | translate }}</strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ doc.name }}
      </div>

      <!-- <div class="col-md-3 col-sm-4" ng-class="{'text-success': oHashValid, 'text-danger': !oHashValid}">
        <strong>{{ 'VERIFY.ORIG_HASH' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': oHashValid, 'glyphicon-remove': !oHashValid}"></i></strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ doc.originalHash }}
        <a href="" ng-show="!oHashValid" ng-click="showOHashError = !showOHashError">{{ 'VERIFY.WHY' | translate }}</a>
        <p class="alert alert-danger alert-incorrect" ng-show="showOHashError" role="alert">
          {{ 'VERIFY.WRONG_HASH' | translate }}
        </p>
      </div> -->

    </div>

    <div class="verify-info row top-padder-md" id="signers" ng-repeat="signature in signatures">
      <div class="col-md-3 col-sm-4" ng-class="{'text-success': signature.valid, 'text-danger': !signature.valid}">
        <strong>
          {{ 'VERIFY.SIGNER' | translate }}
          <span ng-show="signatures.length > 1">{{$index + 1}}</span>
          <i class="glyphicon" ng-class="{'glyphicon-ok': signature.valid, 'glyphicon-remove': !signature.valid}"></i>
        </strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.signer.name }} &lt;{{ signature.signer.email }}&gt; <br>
        <span>{{ 'VERIFY.ID' | translate }}: {{ signature.signer.id }}</span>
      </div>
      <!--
      <div class="col-md-3 col-sm-4">
        <strong>{{ 'VERIFY.ID' | translate }}</strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.signer.id }}
      </div>

      <div class="col-md-3 col-sm-4">
        <strong>{{ 'VERIFY.SIG_DATE' | translate }}</strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.signedAt | date:'medium':'UTC' }}
      </div>

      <div class="col-md-3 col-sm-4" ng-class="{'text-success': signature.certificate.valid, 'text-danger': !signature.certificate.valid}">
        <strong>{{ 'VERIFY.CERT_NUMBER' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': signature.certificate.valid, 'glyphicon-remove': !signature.certificate.valid}"></i></strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.certificate.getSerialNumber() }}
        <a href="" ng-show="!signature.certificate.valid" ng-click="signature.showCertError = !signature.showCertError">{{ 'VERIFY.WHY' | translate }}</a>
        <p class="alert alert-danger alert-incorrect" ng-show="signature.showCertError" role="alert">
          {{ 'VERIFY.WRONG_CERT' | translate }}
        </p>
      </div>

      <div class="col-md-3 col-sm-4" ng-class="{'text-success': signature.valid, 'text-danger': !signature.valid}">
        <strong>{{ 'VERIFY.SIGNATURE' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': signature.valid, 'glyphicon-remove': !signature.valid}"></i></strong>
      </div>
      <div class="col-md-9 col-sm-8 text-break">
        <p>{{ signature.sig('base64') }}</p>
        <a href="" ng-show="!signature.valid" ng-click="signature.showValidError = !signature.showValidError">{{ 'VERIFY.WHY' | translate }}</a>
        <p class="alert alert-danger alert-incorrect" ng-show="signature.showValidError" role="alert">
          {{ 'VERIFY.WRONG_SIG' | translate }}
        </p>
      </div> -->
    </div>

    <div ng-show="record" class="verify-info row top-padder-md" id="conservancy-record">
      <div class="col-md-12" ng-class="{'text-danger': !record.validArchive || !record.valid}">
        <strong>
          {{ 'VERIFY.CONSERVANCY_RECORD' | translate }} <i class="glyphicon" ng-class="{'glyphicon-ok': record.validArchive, 'glyphicon-remove': !record.validArchive || !record.valid}"></i>
        </strong>
        <!-- <a ng-show="!record.valid" href="" ng-click="record.showValidCR = !record.showValidCR">{{ 'VERIFY.WHY' | translate }}</a> -->
      </div>

      <div class="col-md-12" ng-show="record.valid">
        <p class="alert alert-danger alert-incorrect" ng-show="record.showValidCR" role="alert">
          {{ 'VERIFY.RECORD.WRONG_CR' | translate }}
        </p>
        <p class="text-danger" ng-show="!record.validArchive">
          {{ 'VERIFY.RECORD.WRONG_ARCHIVE' | translate }}
        </p>
        <p class="text-danger" ng-show="record.validArchive">
          {{ 'VERIFY.RECORD.VALID_ARCHIVE' | translate }}
        </p>
        <!-- <div class="col-md-3 col-sm-4" ng-class="{'text-success': record.validCA, 'text-danger': !record.validCA}">
          <strong>{{ 'VERIFY.RECORD.ISSUER' | translate }}</strong>
          <i class="glyphicon" ng-class="{'glyphicon-ok': record.validCA, 'glyphicon-remove': !record.validCA}"></i>
        </div>
        <div class="col-md-9 col-sm-8">
          {{ record.caName() }}
        </div> -->

        <!-- <div class="col-md-3 col-sm-4" ng-class="{'text-success': record.validTS, 'text-danger': !record.validTS}">
          <strong>
            {{ 'VERIFY.RECORD.TIMESTAMP' | translate }}
            <i class="glyphicon" ng-class="{'glyphicon-ok': record.validTS, 'glyphicon-remove': !record.validTS}"></i>
          </strong>
        </div>
        <div class="col-md-9 col-sm-8">
          {{ record.recordTimestamp() | date:'medium':'UTC' }}
          <a href="" ng-show="!record.validTS" ng-click="record.showValidTS = !record.showValidTS">{{ 'VERIFY.WHY' | translate }}</a>
          <p class="alert alert-danger alert-incorrect" ng-show="record.showValidTS" role="alert">
            {{ 'VERIFY.RECORD.WRONG_TS' | translate:record.tsTranslation }}
          </p>
        </div> -->

        <!-- <div class="col-md-3 col-sm-4" ng-class="{'text-success': record.validArchive, 'text-danger': !record.validArchive}">
          <strong>
            {{ 'VERIFY.RECORD.VALIDITY' | translate }}
            <i class="glyphicon" ng-class="{'glyphicon-ok': record.validArchive, 'glyphicon-remove': !record.validArchive}"></i>
          </strong>
        </div> -->
        <!-- <div class="col-md-9 col-sm-8">
          <p ng-show="!record.validArchive">
            {{ 'VERIFY.RECORD.WRONG_ARCHIVE' | translate }}
          </p>
          <p ng-show="record.validArchive">
            {{ 'VERIFY.RECORD.VALID_ARCHIVE' | translate }}
          </p>
        </div> -->
      </div>
    </div>

    <div ng-show="details" id="details-modal" class="fiesta-modal">
      <div class="modal-back-screen" ng-click="details = false"></div>
      <div class="modal-content">
        <h4 class="center">{{ doc.name }}</h4>
        <div class="bottom-padder-md">
          <strong>{{ 'VERIFY.ORIG_HASH' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': oHashValid, 'glyphicon-remove': !oHashValid}"></i></strong>
          <div>
            {{ doc.originalHash }}
          </div>
        </div>

        <div class="bottom-padder-md" ng-repeat="signature in signatures">
          <strong>
            {{ 'VERIFY.SIGNER' | translate }}
            <span ng-show="signatures.length > 1">{{$index + 1}}</span>:
            {{ signature.signer.name }}
            <i class="glyphicon" ng-class="{'glyphicon-ok': signature.valid, 'glyphicon-remove': !signature.valid}"></i>
          </strong>
          <div>
            {{ 'VERIFY.EMAIL' | translate }}: {{ signature.signer.email }} <br>
            {{ 'VERIFY.ID' | translate }}: {{ signature.signer.id }} <br>
            {{ 'VERIFY.SIG_DATE' | translate }}: {{ signature.signedAt | date:'medium':'UTC' }} <br>
            <a href="" class="see-signature"
              ng-class="{'active': signature.seeSignature}"
              ng-click="signature.seeSignature = !signature.seeSignature">
              {{ 'VERIFY.SEE_SIG' | translate }}
            </a>
            <div class="long-signature" ng-show="signature.seeSignature">
              {{ signature.sig('base64') }}
            </div>
          </div>
          <!--
          <div class="col-md-3 col-sm-4">
            <strong>{{ 'VERIFY.ID' | translate }}</strong>
          </div>
          <div class="col-md-9 col-sm-8">
            {{ signature.signer.id }}
          </div>

          <div class="col-md-3 col-sm-4">
            <strong>{{ 'VERIFY.SIG_DATE' | translate }}</strong>
          </div>
          <div class="col-md-9 col-sm-8">
            {{ signature.signedAt | date:'medium':'UTC' }}
          </div>

          <div class="col-md-3 col-sm-4" ng-class="{'text-success': signature.certificate.valid, 'text-danger': !signature.certificate.valid}">
            <strong>{{ 'VERIFY.CERT_NUMBER' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': signature.certificate.valid, 'glyphicon-remove': !signature.certificate.valid}"></i></strong>
          </div>
          <div class="col-md-9 col-sm-8">
            {{ signature.certificate.getSerialNumber() }}
            <a href="" ng-show="!signature.certificate.valid" ng-click="signature.showCertError = !signature.showCertError">{{ 'VERIFY.WHY' | translate }}</a>
            <p class="alert alert-danger alert-incorrect" ng-show="signature.showCertError" role="alert">
              {{ 'VERIFY.WRONG_CERT' | translate }}
            </p>
          </div>

          <div class="col-md-3 col-sm-4" ng-class="{'text-success': signature.valid, 'text-danger': !signature.valid}">
            <strong>{{ 'VERIFY.SIGNATURE' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': signature.valid, 'glyphicon-remove': !signature.valid}"></i></strong>
          </div>
          <div class="col-md-9 col-sm-8 text-break">
            <p>{{ signature.sig('base64') }}</p>
            <a href="" ng-show="!signature.valid" ng-click="signature.showValidError = !signature.showValidError">{{ 'VERIFY.WHY' | translate }}</a>
            <p class="alert alert-danger alert-incorrect" ng-show="signature.showValidError" role="alert">
              {{ 'VERIFY.WRONG_SIG' | translate }}
            </p>
          </div> -->
        </div>

        <div class="bottom-padder-md">
          <strong>
            {{ 'VERIFY.CONSERVANCY_RECORD' | translate }} <i class="glyphicon" ng-class="{'glyphicon-ok': record.validArchive, 'glyphicon-remove': !record.validArchive || !record.valid}"></i>
          </strong> <br>

          <span>{{ 'VERIFY.RECORD.ISSUER' | translate }}: {{ record.caName() }}</span> <br>

          <span>{{ 'VERIFY.RECORD.TIMESTAMP' | translate }}: {{ record.recordTimestamp() | date:'medium':'UTC' }}</span>

          <p class="alert alert-danger alert-incorrect" ng-show="record.showValidTS" role="alert">
            {{ 'VERIFY.RECORD.WRONG_TS' | translate:record.tsTranslation }}
          </p>

          <p class="alert alert-danger alert-incorrect" ng-show="record.showValidCR" role="alert">
            {{ 'VERIFY.RECORD.WRONG_CR' | translate }}
          </p>
          <p class="text-danger" ng-show="!record.validArchive">
            {{ 'VERIFY.RECORD.WRONG_ARCHIVE' | translate }}
          </p>
          <p class="text-danger" ng-show="record.validArchive">
            {{ 'VERIFY.RECORD.VALID_ARCHIVE' | translate }}
          </p>
        </div>
      </div>
    </div>

    <div class="row top-padder-md bottom-padder-md center">
      <button class="btn-md btn-darkgrey" ng-click="details = true">{{ 'VERIFY.SEE_DETAILS' | translate }}</button>
    </div>

    <div class="row top-padder-lg bottom-padder-md center">
      <p>{{ 'VERIFY.REVIEW' | translate }}</p>
    </div>

    <hr>
    <div id="pdf-container" class="center top-padder-md">
      <ng-pdf template-url="views/pdfViewer.html"></ng-pdf>
    </div>
  </div>
</div>
