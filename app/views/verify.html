<div class="verify">
  <div id="instructions" ng-if="!ready">
    <div class="row">
      <h2>{{ 'VERIFY.TITLE' | translate }}</h2>
    </div>
    <div class="row bottom-padder-md">
      <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1 col-md-offset-0 col-sm-10 col-sm-offset-1">
        <object data="images/upload_certificates.svg" type="image/svg+xml" alt="Upload Certificates"></object>
        <p>{{ 'VERIFY.ROOT' | translate }}</p>
      </div>
      <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1">
        <object data="images/upload_xml.svg" type="image/svg+xml" alt="Upload XML"></object>
        <p>{{ 'VERIFY.XML' | translate }}</p>
      </div>
      <div class="col-md-4 col-md-offset-0 col-sm-10 col-sm-offset-1">
        <object data="images/verify.svg" type="image/svg+xml" alt="Verify information"></object>
        <p>{{ 'VERIFY.VALIDATION' | translate }}</p>
      </div>
    </div>
    <div class="row top-padder-md">
      <button class="btn-lg btn-success" ui-sref="config">{{ 'VERIFY.GET_STARTED' | translate }}</button>
    </div>
  </div>

  <div class="row" ng-show="ready && !pdfUrl">
    <div class="upload text-center" dropzone>
      <div class="upload-default">
        <div ng-show="!loading">
          <h5 class="bottom-padder-md">{{ 'VERIFY.DRAG' | translate }}</h5>
          <button class="btn">{{ 'VERIFY.SELECT' | translate }}</button>
          <input accept-name="XML" accept="text/xml" text="true" class="file-upload-input" fileread="upload" required="true" type="file">
        </div>
        <div ng-show="loading">
          <h4>{{ 'VERIFY.LOADING' | translate }}</h4>
        </div>
      </div>
    </div>
  </div>

  <div ng-show="pdfUrl && !loading">
    <h2 class="center">{{ 'VERIFY.VALIDATIONS' | translate }}</h2>

    <p class="help-block">{{ 'VERIFY.REMINDER' | translate }}</p>
    <div class="verify-info row top-padder-md">

      <div class="col-md-3 col-sm-4">
        <strong>{{ 'VERIFY.DOCUMENT_NAME' | translate }}</strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ doc.name }}
      </div>

      <div class="col-md-3 col-sm-4" ng-class="{'text-success': oHashValid, 'text-danger': !oHashValid}">
        <strong>{{ 'VERIFY.ORIG_HASH' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': oHashValid, 'glyphicon-remove': !oHashValid}"></i></strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ doc.originalHash }}
        <a href="" ng-show="!oHashValid" ng-click="showOHashError = !showOHashError">{{ 'VERIFY.WHY' | translate }}</a>
        <p class="alert alert-danger alert-incorrect" ng-show="showOHashError" role="alert">
          {{ 'VERIFY.WRONG_HASH' | translate }}
        </p>
      </div>

    </div>

    <div class="verify-info row top-padder-md" id="signers" ng-repeat="signature in signatures">
      <div class="col-md-3 col-sm-4">
        <strong>{{ 'VERIFY.SIGNER' | translate }}</strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.signer.name }} &lt;{{ signature.signer.email }}&gt;
      </div>

      <div class="col-md-3 col-sm-4">
        <strong>{{ 'VERIFY.ID' | translate }}</strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.signer.id }}
      </div>

      <div class="col-md-3 col-sm-4">
        <strong>{{ 'VERIFY.SIG_DATE' | translate }}</strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.signedAt | date:'medium':'UTC' }}
      </div>

      <div class="col-md-3 col-sm-4" ng-class="{'text-success': signature.certificate.valid, 'text-danger': !signature.certificate.valid}">
        <strong>{{ 'VERIFY.CERT_NUMBER' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': signature.certificate.valid, 'glyphicon-remove': !signature.certificate.valid}"></i></strong>
      </div>
      <div class="col-md-9 col-sm-8">
        {{ signature.certificate.getSerialNumber() }}
        <a href="" ng-show="!signature.certificate.valid" ng-click="signature.showCertError = !signature.showCertError">{{ 'VERIFY.WHY' | translate }}</a>
        <p class="alert alert-danger alert-incorrect" ng-show="signature.showCertError" role="alert">
          {{ 'VERIFY.WRONG_CERT' | translate }}
        </p>
      </div>

      <div class="col-md-3 col-sm-4" ng-class="{'text-success': signature.valid, 'text-danger': !signature.valid}">
        <strong>{{ 'VERIFY.SIGNATURE' | translate }}<i class="glyphicon" ng-class="{'glyphicon-ok': signature.valid, 'glyphicon-remove': !signature.valid}"></i></strong>
      </div>
      <div class="col-md-9 col-sm-8 text-break">
        <p>{{ signature.sig('base64') }}</p>
        <a href="" ng-show="!signature.valid" ng-click="signature.showValidError = !signature.showValidError">{{ 'VERIFY.WHY' | translate }}</a>
        <p class="alert alert-danger alert-incorrect" ng-show="signature.showValidError" role="alert">
          {{ 'VERIFY.WRONG_SIG' | translate }}
        </p>
      </div>
    </div>

    <div class="verify-info row top-padder-md" id="conservancy-record">
      <div class="col-md-12" ng-class="{'text-danger': !record.valid}">
        <strong>
          {{ 'VERIFY.CONSERVANCY_RECORD' | translate }}
          <i class="glyphicon" ng-class="{'glyphicon-remove': !record.valid}"></i>
        </strong>
        <a ng-show="!record.valid" href="" ng-click="record.showValidCR = !record.showValidCR">{{ 'VERIFY.WHY' | translate }}</a>
        <p class="alert alert-danger alert-incorrect" ng-show="record.showValidCR" role="alert">
          {{ 'VERIFY.RECORD.WRONG_CR' | translate }}
        </p>
      </div>

      <div ng-show="record.valid">
        <div class="col-md-3 col-sm-4" ng-class="{'text-success': record.validCA, 'text-danger': !record.validCA}">
          <strong>{{ 'VERIFY.RECORD.ISSUER' | translate }}</strong>
          <i class="glyphicon" ng-class="{'glyphicon-ok': record.validCA, 'glyphicon-remove': !record.validCA}"></i>
        </div>
        <div class="col-md-9 col-sm-8">
          {{ record.caName() }}
        </div>

        <div class="col-md-3 col-sm-4" ng-class="{'text-success': record.validTS, 'text-danger': !record.validTS}">
          <strong>
            {{ 'VERIFY.RECORD.TIMESTAMP' | translate }}
            <i class="glyphicon" ng-class="{'glyphicon-ok': record.validTS, 'glyphicon-remove': !record.validTS}"></i>
          </strong>
        </div>
        <div class="col-md-9 col-sm-8">
          {{ record.recordTimestamp() | date:'medium':'UTC' }}
          <a href="" ng-show="!record.validTS" ng-click="record.showValidTS = !record.showValidTS">{{ 'VERIFY.WHY' | translate }}</a>
          <p class="alert alert-danger alert-incorrect" ng-show="record.showValidTS" role="alert">
            {{ 'VERIFY.RECORD.WRONG_TS' | translate:record.tsTranslation }}
          </p>
        </div>
      </div>
    </div>

    <div class="row top-padder-md bottom-padder-md center">
      <p><strong>{{ 'VERIFY.REVIEW' | translate }}</strong></p>
    </div>

    <div class="row bottom-padder-lg center">
      <button class="btn-lg btn-success" ng-click="clear()">{{ 'VERIFY.NEW_DOC' | translate }}</button>
    </div>

    <hr>
    <div id="pdf-container" class="center top-padder-md">
      <ng-pdf template-url="views/pdfViewer.html"></ng-pdf>
    </div>
  </div>
</div>
